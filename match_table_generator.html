<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
	"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<script type="text/javascript">

// returns a team name for a team name in the match list
//   name in the match list may be of the form "Team ..." or not
//   team name returned may be an abbreviation
function fix_team(team)
{
    // list of team names, a line of the form ['A', 'B']
    // means that the team shows up as A on the gosugamers match listing page
    // and we want to write it as B on the match table
    teams = [
             ['Evil...', 'EG'],
             ['Wild Witch...', 'WWD'],
             ['CNB Dota2', 'CNB'],
             ['Meet Your...', 'MYM'],
             ['Team Liquid', 'TL'],
             ['Cloud9', 'C9'],
             ['Revenge eSports', 'Revenge'],
             ['ESFXtv|PowerR...', 'PR'],
             ['Zero Latitude', 'ZL'],
             ['MiTH.TrusT.Do...', 'MiTH'],
             ['Rex Regum Qeon', 'RRQ'],
             ['Monkey Spanner', 'MkSp'],
             ['MVP Phoenix', 'MVP.P'],
             ['Fnatic.Dota2', 'Fnatic'],
             ['Insane Gaming', 'Insane'],
             ['The Retry', 'TR'],
             ['Scythe Gaming', 'Scythe'],
             ['Arrow Gaming', 'Arrow'],
             ['Invictus Gaming', 'iG'],
             ['Union Gaming', 'UG'],
             ['The House is...', 'THD'],
             ['Virtus Pro-Dota2', 'VP'],
             ['Ahead Gaming', 'Ahead'],
             ['RoX.KIS.Dota2', 'RoX.KIS'],
             ['Mineski.Dota2', 'Mineski'],
             ['First Departure', 'FD'],
             ['Sigma...', 'Sigma'],
             ['Team Dog', 'Dog'],
             ['MVP HOT6', 'MVP.h6']
            ];
            
    for (k = 0; k < teams.length; k++)
    {
        if (team === teams[k][0])
        {
            return teams[k][1];
        }
    }

    return team;
}

// returns the abbreviation for the tournament by its identifier in the URI
function fix_tournament(tournament)
{
    tournaments = [
         ['3364-asian-cyber-games-invitational-best-of-the-best', 'ACG'],
         ['3398-starladder-starseries-season-9', 'SL'],
         ['3465-wd-dota-2-pro-series', 'WDPS'],
         ['3135-joindota-league-season-1', 'jDL'],
         ['3145-t-k-o-tournament', 'TKO'],
         ['3340-dotacinema-captains-draft-invitational', 'DCCD'],
         ['3336-korea-dota-2-league', 'KDL'],
         ['3391-gfinity-dota-2-tournament', 'Gfinity'],
         ['3344-netolic-pro-league-5-east', 'Netolic'],
         ['3243-dota-2-champions-league-2', 'D2CL']
        ];

    for (k = 0; k < tournaments.length; k++)
    {
        if (tournament === tournaments[k][0])
        {
            return tournaments[k][1];
        }
    }

    return "???";
}

// returns number of games per match for the given tournament
function tournament_matches(tournament)
{
    bestofs = [
               ['ACG', 3],
               ['SL', 3],
               ['WDPS', 1],
               ['jDL', 2],
               ['KDL', 3],
               ['DCCD', 3],
               ['TKO', 2],
               ['Gfinity', 1],
               ['Netolic', 3],
               ['D2CL', 5]
              ];
              
    for (k = 0; k < bestofs.length; k++)
    {
        if (tournament === bestofs[k][0])
        {
            return bestofs[k][1];
        }
    }
              
    return '?';
}

function generate()
{
    s = document.getElementById("input").value;
    m = document.getElementById("message").value;
    
    a = s.split("\n");
    
    out = "Team 1|  ||Team 2|  |Format|League|[D2Lng](http://www.dota2lounge.com)|[D2W](http://www.dota2wage.com)|Notes\n:---------|:---------:|:---------:|:---------|:---------:|:---------:|:---------:|:---------:|:---------:|:---------\n";
    
    // scan for Upcoming Matches section
    i = 0;
    while (!/<h2>Upcoming Matches/.test(a[i]) && i++ < a.length);
    
    for ( ; i < a.length; i++) 
    {
        /* team 1 and tournament data
    
           these lines are of the form
            
            <a href="/dota2/tournaments/3364-asian-cyber-games-invitational-best-of-the-best/911-playoffs/3369-playoffs/matches/37308-titan-vs-zero-latitude" class="match hover-background" style="background-image: url('/images/icons/games/list/dota2.png');">
            <span class="opp opp1">
            <span>Titan</span><span title="Malaysia" class="flag MY"></span> </span>
            <span class="bet-percentage bet1">(89%)</span>

        */
        if (/opp opp1/.test(a[i]))
        {
            team1 = a[i+1];
            team1 = team1.substr(6);
            j = team1.search(/<\/span>/);
            team1 = team1.substr(0,j);
            team1 = fix_team(team1);
            
            pct1 = a[i+2];
            pct1 = pct1.substr(35);
            j = pct1.search(/\)/);
            pct1 = pct1.substr(0,j);
            
            out = out + "**" + team1 + "**|" + pct1 + "|Vs.|";
            
            tournament = a[i-1];
            tournament = tournament.substr(28);
            j = tournament.search(/\//);
            tournament = tournament.substr(0,j);
            tournament = fix_tournament(tournament);

            bestof = tournament_matches(tournament);
        }
        
        /* team 2 data
    
           these lines are of the form
            
            <span class="bet-percentage bet2">(11%)</span>
            <span class="opp opp2">
            <span title="Indonesia" class="flag ID"></span><span>Zero Latitude</span> </span>

        */
        if (/opp opp2/.test(a[i]))
        {
            team2 = a[i+1];
            j = team2.search(/<span>/);
            team2 = team2.substr(j+6);
            j = team2.search(/<\/span>/);
            team2 = team2.substr(0,j);            
            team2 = fix_team(team2);
            
            pct2 = a[i-1];
            pct2 = pct2.substr(35);
            j = pct2.search(/\)/);
            pct2 = pct2.substr(0,j);
        }
        
        /* time to match, of the form
        
            <span class="live-in">
            1h 8m </span>

        */
        if (/<span class="live-in">/.test(a[i]))
        {   
            t = a[i+1];
        
            if (/d/.test(t))
            {
                note = "starts in >24 hr";
            }
            else
            {
                note = "";
            }
            
            if (tournament == "DCCD")
            {
                note = "Captain's draft" + note;
            }
            
            out = out + "**" + team2 + "**|" + pct2 + "|";
            out = out + "BO" + bestof + "|" + tournament + "|||" + note + "\n";
        }
        
        // stop once past Upcoming Matches
        if (/Recent Results/.test(a[i]))
        {
            break;
        }
    }
    
    out = out + "\n" + m + "\n\n";
    out = out + "Useful Links:\n\n[Gosubet](http://www.gosugamers.net/dota2/gosubet) | [joinDOTA](http://www.joindota.com/en/start) | [List of teams' dotabuff](http://www.reddit.com/r/dota2loungebets/comments/1rub4h/compiled_list_of_most_dota_2_teams_dotabuff_and_a/) | [How to participate in Guild Chat](http://www.reddit.com/r/dota2loungebets/comments/1qivbl/guild_rd2lb_guild_is_open_for_people_to_join/)";
    
    document.getElementById("output").value = out;
    document.getElementById("output").select();
}    
</script>

<head>
	<title>Match table generator</title>
</head>
<body>

<h1>Match table generator</h1>

<p>This tool generates a match table for the <a href="http://www.reddit.com/r/dota2loungebets/">dota2loungebets forum</a> on reddit.  To use this tool:
<ol>
  <li>Go to the <a href="http://www.gosugamers.net/dota2/gosubet?u-page=1">GosuGamers match listing page</a> and view source (or go straight to <a href="view-source:http://www.gosugamers.net/dota2/gosubet?u-page=1">the page source</a> in Chrome & Firefox).</li>
  <li>Select all and copy.</li>
  <li>Paste this into the Page Source box on this page.</li>
  <li>Optionally put something in the Message box.</li>
  <li>Click Generate, the output will appear in the box below (already selected).  Copy it, and use it to start a <a href="http://www.reddit.com/r/dota2loungebets/submit?selftext=true">new thread on /r/dota2loungebets</a>.</li>
</ol>
</p>

<p>
<b>Page Source</b><br />
<textarea rows="4" cols="40" id="input"></textarea><br />
<b>Message</b><br />
<textarea rows="1" cols="40" id="message">

</textarea><br />
<button type="submit" id="generate" onclick="generate()">Generate</button>
</p>

<p>
<b>Output</b><br />
<textarea rows="4" cols="40" id="output"></textarea>
</p>

<h2>Notes</h2>
<ul>
  <li>This table is no more accurate than GosuGamers' match listings.</li>
  <li>This tool is intended to be used at around the time that the daily thread is posted on /r/dota2loungebets, so only the matches within 24 hours are relevant.  A comment will be added if a match is over 24 hours away, so be sure to check if those belong in the day's thread or not.</li>
  <li>If there are more matches within 24 hours than are on the first page of the GosuGamers match list, you'll need to fetch the second page also: <a href="http://www.gosugamers.net/dota2/gosubet?u-page=2">page 2</a> <a href="view-source:http://www.gosugamers.net/dota2/gosubet?u-page=2">[source]</a>.  Manually concatenate them (and delete the header from the second table).
  <li>This translation script relies on manually-entered data (team and tournament abbreviations, and how many games per match in a tournament).  As new teams and tournaments are added, the lookup tables need to be updated.  To provide updated information, please leave feedback in <a href="">this thread</a> or send a pull request on <a href="https://github.com/dota2dino/dota2dino.github.io">the  GitHub page for this site</a>.</li>
  <li>The number of games in a match may change throughout a tournament, and even if this number is updated correctly it still may not be correct.  For example, Starladder matches start as 1, then 3, then 5 games per match, but one region's BO1 phase may overlap another region's BO3 phase.  Unfortunately, without a dynamic language it's not possible the check the individual match pages for the number of games.</li>
</ul>

</body>
</html>
